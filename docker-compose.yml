version: '3.8'

services:
  cangjie-mem:
    # 使用 GitHub Container Registry 镜像
    image: ghcr.io/ystyle/cangjie-mem:1.0.0
    container_name: cangjie-mem
    restart: unless-stopped

    # 端口映射
    ports:
      - "8080:8080"

    # 环境变量配置
    environment:
      # 启用 HTTP 模式（Docker 部署必需）
      - CANGJIE_HTTP=true
      # HTTP 监听地址（可选，默认 :8080）
      - CANGJIE_ADDR=:8080
      # 启用 REST API
      - CANGJIE_API_ENABLED=true
      # 启用 Web UI
      - CANGJIE_UI_ENABLED=true
      # 可选：启用 Token 认证（取消注释并修改）
      # - CANGJIE_TOKEN=your-secret-token

    # 数据卷（持久化数据库）
    volumes:
      - cangjie-data:/home/cangjie/.cangjie-mem

    # 健康检查
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:8080/api/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s

    # 日志配置
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  cangjie-data:
    driver: local
